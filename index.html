<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - R/M TRENDING Exchange</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: #1e293b;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            border-right: 1px solid #334155;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .sidebar.collapsed { width: 80px; }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            margin: 4px 0;
        }
        
        .menu-item:hover, .menu-item.active {
            background: #334155;
            border-left-color: #3b82f6;
            color: #60a5fa;
        }
        
        .menu-item i { width: 24px; text-align: center; }
        
        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
            transition: all 0.3s;
        }
        
        .sidebar.collapsed + .main-content { margin-left: 80px; }
        
        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
            transition: transform 0.3s;
        }
        
        .stat-card:hover { transform: translateY(-5px); }
        
        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: #1e293b;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table th {
            background: #0f172a;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #94a3b8;
            border-bottom: 1px solid #334155;
        }
        
        .data-table td {
            padding: 16px;
            border-bottom: 1px solid #334155;
        }
        
        .data-table tr:hover td { background: #334155; }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body { padding: 24px; }
        
        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
        }
        
        /* Visual Editor Mode */
        body.editor-mode [data-editable] {
            position: relative;
            outline: 2px dashed #3b82f6;
            outline-offset: 2px;
            cursor: pointer;
            background: rgba(59,130,246,0.1);
        }
        
        body.editor-mode [data-editable]:hover {
            background: rgba(59,130,246,0.2);
            outline-style: solid;
        }
        
        body.editor-mode [data-editable]::before {
            content: '✏️ ' attr(data-editable);
            position: absolute;
            top: -30px;
            left: 0;
            background: #3b82f6;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 100;
        }
        
        /* Payment Method Cards */
        .payment-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .payment-card.active { border-color: #10b981; }
        .payment-card.inactive { border-color: #ef4444; opacity: 0.7; }
        
        .status-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.active { background: #10b981; color: white; }
        .status-badge.inactive { background: #ef4444; color: white; }
        
        /* QR Code Preview */
        .qr-preview {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #475569;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-switch.active { background: #10b981; }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }
        
        .toggle-switch.active::after { left: 26px; }
        
        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: #1e293b;
            border-left: 4px solid #3b82f6;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
            min-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; }
        }
        
        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #334155;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Tabs */
        .tabs { display: flex; gap: 4px; border-bottom: 1px solid #334155; margin-bottom: 24px; }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #94a3b8;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab:hover { color: #e2e8f0; }
        .tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-[#0f172a] z-50 flex items-center justify-center p-4">
        <div class="bg-[#1e293b] border border-[#334155] rounded-2xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-[#3b82f6] mb-2">R/M TRENDING</h1>
                <p class="text-[#94a3b8]">एडमिन पैनल</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="form-label">ईमेल</label>
                    <input type="email" id="adminEmail" class="form-input" placeholder="admin@example.com">
                </div>
                <div>
                    <label class="form-label">पासवर्ड</label>
                    <input type="password" id="adminPassword" class="form-input" placeholder="••••••••">
                </div>
                <button onclick="adminLogin()" class="btn btn-primary w-full justify-center">
                    <i class="fas fa-sign-in-alt"></i> लॉगिन करें
                </button>
            </div>
            
            <div class="mt-6 text-center text-sm text-[#94a3b8]">
                डिफॉल्ट: admin@rm.com / admin123
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-alt text-2xl text-[#3b82f6]"></i>
            <div class="sidebar-text">
                <h2 class="font-bold text-lg">एडमिन पैनल</h2>
                <p class="text-xs text-[#94a3b8]">R/M Exchange</p>
            </div>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i>
                <span class="sidebar-text">डैशबोर्ड</span>
            </div>
            
            <div class="menu-item" onclick="showSection('website')">
                <i class="fas fa-edit"></i>
                <span class="sidebar-text">वेबसाइट एडिटर</span>
            </div>
            
            <div class="menu-item" onclick="showSection('payments')">
                <i class="fas fa-credit-card"></i>
                <span class="sidebar-text">पेमेंट मेथड्स</span>
            </div>
            
            <div class="menu-item" onclick="showSection('deposits')">
                <i class="fas fa-arrow-down"></i>
                <span class="sidebar-text">डिपॉजिट्स</span>
                <span id="depositBadge" class="ml-auto bg-[#ef4444] text-white text-xs px-2 py-1 rounded-full hidden">0</span>
            </div>
            
            <div class="menu-item" onclick="showSection('withdrawals')">
                <i class="fas fa-arrow-up"></i>
                <span class="sidebar-text">विथड्रॉअल्स</span>
                <span id="withdrawalBadge" class="ml-auto bg-[#f59e0b] text-white text-xs px-2 py-1 rounded-full hidden">0</span>
            </div>
            
            <div class="menu-item" onclick="showSection('users')">
                <i class="fas fa-users"></i>
                <span class="sidebar-text">यूजर्स</span>
            </div>
            
            <div class="menu-item" onclick="showSection('nft')">
                <i class="fas fa-image"></i>
                <span class="sidebar-text">NFT मैनेजमेंट</span>
            </div>
            
            <div class="menu-item" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span class="sidebar-text">सेटिंग्स</span>
            </div>
            
            <div class="menu-item text-[#ef4444]" onclick="adminLogout()">
                <i class="fas fa-sign-out-alt"></i>
                <span class="sidebar-text">लॉगआउट</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold mb-2" id="pageTitle">डैशबोर्ड</h1>
                <p class="text-[#94a3b8]">स्वागत है, <span id="adminName">एडमिन</span></p>
            </div>
            
            <div class="flex items-center gap-4">
                <button onclick="toggleEditorMode()" id="editorToggle" class="btn btn-warning hidden">
                    <i class="fas fa-pencil-alt"></i> एडिटर मोड
                </button>
                <div class="w-10 h-10 rounded-full bg-[#3b82f6] flex items-center justify-center">
                    <i class="fas fa-user-shield text-white"></i>
                </div>
            </div>
        </div>

        <!-- DASHBOARD SECTION -->
        <section id="dashboardSection" class="section-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-[#94a3b8] text-sm">कुल यूजर्स</p>
                            <h3 class="text-3xl font-bold mt-1" id="totalUsers">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-lg bg-[#3b82f6]/20 flex items-center justify-center">
                            <i class="fas fa-users text-[#3b82f6] text-xl"></i>
                        </div>
                    </div>
                    <div class="text-sm text-[#10b981]">
                        <i class="fas fa-arrow-up"></i> +12% इस महीने
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-[#94a3b8] text-sm">कुल डिपॉजिट्स</p>
                            <h3 class="text-3xl font-bold mt-1" id="totalDeposits">₹0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-lg bg-[#10b981]/20 flex items-center justify-center">
                            <i class="fas fa-wallet text-[#10b981] text-xl"></i>
                        </div>
                    </div>
                    <div class="text-sm text-[#10b981]">
                        <i class="fas fa-arrow-up"></i> +8% इस महीने
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-[#94a3b8] text-sm">पेंडिंग डिपॉजिट्स</p>
                            <h3 class="text-3xl font-bold mt-1 text-[#f59e0b]" id="pendingDeposits">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-lg bg-[#f59e0b]/20 flex items-center justify-center">
                            <i class="fas fa-clock text-[#f59e0b] text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-[#94a3b8] text-sm">पेंडिंग विथड्रॉअल्स</p>
                            <h3 class="text-3xl font-bold mt-1 text-[#ef4444]" id="pendingWithdrawals">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-lg bg-[#ef4444]/20 flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-[#ef4444] text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-[#1e293b] border border-[#334155] rounded-xl p-6">
                    <h3 class="text-lg font-bold mb-4">हाल की गतिविधियाँ</h3>
                    <canvas id="activityChart" height="250"></canvas>
                </div>
                
                <div class="bg-[#1e293b] border border-[#334155] rounded-xl p-6">
                    <h3 class="text-lg font-bold mb-4">पेमेंट विधियाँ स्थिति</h3>
                    <div id="paymentStatusList" class="space-y-3">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </section>

        <!-- WEBSITE EDITOR SECTION -->
        <section id="websiteSection" class="section-content hidden">
            <div class="bg-[#1e293b] border border-[#334155] rounded-xl p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">वेबसाइट कंटेंट एडिटर</h2>
                        <p class="text-[#94a3b8] mt-1">किसी भी आइटम पर क्लिक करके एडिट करें</p>
                    </div>
                    <button onclick="refreshContent()" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> रीफ्रेश
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="contentEditorGrid">
                    <!-- Dynamic content items -->
                </div>
            </div>
            
            <div class="bg-yellow-500/10 border border-yellow-500/50 rounded-xl p-4 flex items-center gap-3">
                <i class="fas fa-lightbulb text-yellow-500 text-xl"></i>
                <p class="text-sm">प्रत्येक परिवर्तन स्वचालित रूप से सेव हो जाता है। यूजर को तुरंत दिखाई देगा।</p>
            </div>
        </section>

        <!-- PAYMENTS SECTION -->
        <section id="paymentsSection" class="section-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">पेमेंट मेथड्स मैनेजमेंट</h2>
                <button onclick="openPaymentModal()" class="btn btn-primary">
                    <i class="fas fa-plus"></i> नया पेमेंट मेथड जोड़ें
                </button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="switchPaymentTab('upi')">UPI</div>
                <div class="tab" onclick="switchPaymentTab('bank')">बैंक ट्रांसफर</div>
                <div class="tab" onclick="switchPaymentTab('crypto')">क्रिप्टो</div>
            </div>
            
            <div id="upiPayments" class="tab-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="upiList">
                    <!-- UPI Cards -->
                </div>
            </div>
            
            <div id="bankPayments" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="bankList">
                    <!-- Bank Cards -->
                </div>
            </div>
            
            <div id="cryptoPayments" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="cryptoList">
                    <!-- Crypto Cards -->
                </div>
            </div>
        </section>

        <!-- DEPOSITS SECTION -->
        <section id="depositsSection" class="section-content hidden">
            <h2 class="text-2xl font-bold mb-6">डिपॉजिट रिक्वेस्ट्स</h2>
            
            <div class="bg-[#1e293b] border border-[#334155] rounded-xl overflow-hidden">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>यूजर</th>
                            <th>मेथड</th>
                            <th>राशि</th>
                            <th>विवरण</th>
                            <th>प्रूफ</th>
                            <th>तारीख</th>
                            <th>स्थिति</th>
                            <th>एक्शन</th>
                        </tr>
                    </thead>
                    <tbody id="depositsTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- WITHDRAWALS SECTION -->
        <section id="withdrawalsSection" class="section-content hidden">
            <h2 class="text-2xl font-bold mb-6">विथड्रॉअल रिक्वेस्ट्स</h2>
            
            <div class="bg-[#1e293b] border border-[#334155] rounded-xl overflow-hidden">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>यूजर</th>
                            <th>मेथड</th>
                            <th>राशि</th>
                            <th>डिटेल्स</th>
                            <th>तारीख</th>
                            <th>स्थिति</th>
                            <th>एक्शन</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalsTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- USERS SECTION -->
        <section id="usersSection" class="section-content hidden">
            <h2 class="text-2xl font-bold mb-6">यूजर मैनेजमेंट</h2>
            
            <div class="bg-[#1e293b] border border-[#334155] rounded-xl overflow-hidden">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>यूजर ID</th>
                            <th>प्रोफाइल</th>
                            <th>ईमेल</th>
                            <th>बैलेंस</th>
                            <th>KYC</th>
                            <th>स्थिति</th>
                            <th>एक्शन</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- NFT SECTION -->
        <section id="nftSection" class="section-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">NFT मैनेजमेंट</h2>
                <button onclick="openNFTModal()" class="btn btn-primary">
                    <i class="fas fa-plus"></i> नया NFT जोड़ें
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="nftGrid">
                <!-- NFT Cards -->
            </div>
        </section>

        <!-- SETTINGS SECTION -->
        <section id="settingsSection" class="section-content hidden">
            <h2 class="text-2xl font-bold mb-6">सिस्टम सेटिंग्स</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-[#1e293b] border border-[#334155] rounded-xl p-6">
                    <h3 class="text-lg font-bold mb-4">वेबसाइट सेटिंग्स</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-[#0f172a] rounded-lg">
                            <div>
                                <div class="font-medium">मेंटेनेंस मोड</div>
                                <div class="text-sm text-[#94a3b8]">वेबसाइट बंद करें</div>
                            </div>
                            <div class="toggle-switch" onclick="toggleSetting(this, 'maintenance')"></div>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-[#0f172a] rounded-lg">
                            <div>
                                <div class="font-medium">नए रजिस्ट्रेशन</div>
                                <div class="text-sm text-[#94a3b8]">नए यूजर रजिस्टर कर सकें</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSetting(this, 'registration')"></div>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-[#0f172a] rounded-lg">
                            <div>
                                <div class="font-medium">डिपॉजिट्स</div>
                                <div class="text-sm text-[#94a3b8]">डिपॉजिट स्वीकार करें</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSetting(this, 'deposits')"></div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-[#1e293b] border border-[#334155] rounded-xl p-6">
                    <h3 class="text-lg font-bold mb-4">सुरक्षा</h3>
                    <div class="space-y-4">
                        <button onclick="changeAdminPassword()" class="w-full btn btn-primary justify-center">
                            <i class="fas fa-key"></i> पासवर्ड बदलें
                        </button>
                        <button onclick="backupDatabase()" class="w-full btn btn-warning justify-center">
                            <i class="fas fa-download"></i> डेटाबेस बैकअप
                        </button>
                        <button onclick="clearCache()" class="w-full btn btn-danger justify-center">
                            <i class="fas fa-trash"></i> कैश साफ़ करें
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Payment Method Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-xl font-bold" id="paymentModalTitle">पेमेंट मेथड जोड़ें</h3>
                <button onclick="closePaymentModal()" class="text-[#94a3b8] hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="paymentId">
                
                <div class="form-group">
                    <label class="form-label">प्रकार</label>
                    <select id="paymentType" class="form-input" onchange="updatePaymentForm()">
                        <option value="upi">UPI</option>
                        <option value="bank">बैंक अकाउंट</option>
                        <option value="crypto">क्रिप्टो</option>
                    </select>
                </div>
                
                <!-- UPI Fields -->
                <div id="upiFields">
                    <div class="form-group">
                        <label class="form-label">UPI ID</label>
                        <input type="text" id="upiId" class="form-input" placeholder="example@upi">
                    </div>
                    <div class="form-group">
                        <label class="form-label">नाम (डिस्प्ले के लिए)</label>
                        <input type="text" id="upiName" class="form-input" placeholder="Paytm UPI">
                    </div>
                    <div class="form-group">
                        <label class="form-label">QR कोड</label>
                        <input type="file" id="upiQr" accept="image/*" class="form-input" onchange="previewQR(this)">
                        <img id="qrPreview" class="qr-preview hidden">
                    </div>
                </div>
                
                <!-- Bank Fields -->
                <div id="bankFields" class="hidden">
                    <div class="form-group">
                        <label class="form-label">बैंक नाम</label>
                        <input type="text" id="bankName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">अकाउंट नंबर</label>
                        <input type="text" id="accountNumber" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">IFSC कोड</label>
                        <input type="text" id="ifscCode" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">अकाउंट धारक का नाम</label>
                        <input type="text" id="accountHolder" class="form-input">
                    </div>
                </div>
                
                <!-- Crypto Fields -->
                <div id="cryptoFields" class="hidden">
                    <div class="form-group">
                        <label class="form-label">करेंसी</label>
                        <select id="cryptoCurrency" class="form-input">
                            <option value="BTC">Bitcoin (BTC)</option>
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="USDT">USDT</option>
                            <option value="USDC">USDC</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">नेटवर्क</label>
                        <select id="cryptoNetwork" class="form-input">
                            <option value="TRC20">TRC20 (Tron)</option>
                            <option value="ERC20">ERC20 (Ethereum)</option>
                            <option value="BEP20">BEP20 (BSC)</option>
                            <option value="BTC">BTC</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">पता (Address)</label>
                        <input type="text" id="cryptoAddress" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">न्यूनतम डिपॉजिट (₹)</label>
                    <input type="number" id="minDeposit" class="form-input" value="100">
                </div>
                
                <div class="form-group">
                    <label class="form-label">अधिकतम डिपॉजिट (₹)</label>
                    <input type="number" id="maxDeposit" class="form-input" value="100000">
                </div>
                
                <div class="flex items-center gap-3 mb-6">
                    <input type="checkbox" id="paymentActive" checked class="w-4 h-4 rounded">
                    <label for="paymentActive">सक्रिय करें</label>
                </div>
                
                <button onclick="savePaymentMethod()" class="btn btn-primary w-full justify-center">
                    <i class="fas fa-save"></i> सेव करें
                </button>
            </div>
        </div>
    </div>

    <!-- NFT Modal -->
    <div class="modal" id="nftModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-xl font-bold">NFT जोड़ें/एडिट करें</h3>
                <button onclick="closeNFTModal()" class="text-[#94a3b8] hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="nftId">
                
                <div class="form-group">
                    <label class="form-label">NFT नाम</label>
                    <input type="text" id="nftName" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">विवरण</label>
                    <textarea id="nftDesc" class="form-input" rows="3"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">कीमत (ETH)</label>
                        <input type="number" id="nftPrice" class="form-input" step="0.001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">कैटेगरी</label>
                        <select id="nftCategory" class="form-input">
                            <option value="art">Art</option>
                            <option value="collectible">Collectible</option>
                            <option value="gaming">Gaming</option>
                            <option value="music">Music</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">इमेज</label>
                    <input type="file" id="nftImage" accept="image/*" class="form-input" onchange="previewNFT(this)">
                    <img id="nftPreview" class="mt-2 max-h-32 rounded hidden">
                </div>
                
                <button onclick="saveNFT()" class="btn btn-primary w-full justify-center mt-4">
                    <i class="fas fa-save"></i> सेव करें
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Content Modal -->
    <div class="modal" id="editContentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-xl font-bold">कंटेंट एडिट करें</h3>
                <button onclick="closeEditModal()" class="text-[#94a3b8] hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">की (Key)</label>
                    <input type="text" id="editKey" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">मान (Value)</label>
                    <textarea id="editValue" class="form-input" rows="4"></textarea>
                </div>
                <button onclick="saveContentEdit()" class="btn btn-primary w-full justify-center">
                    <i class="fas fa-save"></i> अपडेट करें
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyDCHUmML-3xe57TJAiZKSTHouFxIiFHGoE",
            authDomain: "etf-rm.firebaseapp.com",
            projectId: "etf-rm",
            storageBucket: "etf-rm.firebasestorage.app",
            messagingSenderId: "1013121735332",
            appId: "1:1013121735332:web:2665a687123c2a95416431"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        const cloudinaryCloudName = 'debp1kjtm';
        const cloudinaryUploadPreset = 'sql_admin';
        
        // ==========================================
        // GLOBAL STATE
        // ==========================================
        
        let currentAdmin = null;
        let editorMode = false;
        let currentEditingKey = null;
        let activityChart = null;
        
        // Default admin credentials (change in production)
        const ADMIN_EMAIL = 'admin@rm.com';
        const ADMIN_PASS = 'admin123';
        
        // ==========================================
        // AUTHENTICATION
        // ==========================================
        
        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const pass = document.getElementById('adminPassword').value;
            
            if (email === ADMIN_EMAIL && pass === ADMIN_PASS) {
                currentAdmin = { email, name: 'एडमिन' };
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminName').textContent = currentAdmin.name;
                initDashboard();
                showToast('सफलतापूर्वक लॉगिन हो गया!', 'success');
            } else {
                showToast('गलत ईमेल या पासवर्ड!', 'error');
            }
        }
        
        function adminLogout() {
            currentAdmin = null;
            location.reload();
        }
        
        // ==========================================
        // NAVIGATION
        // ==========================================
        
        function showSection(section) {
            // Update menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(sec => {
                sec.classList.add('hidden');
            });
            
            // Show selected
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            // Update title
            const titles = {
                dashboard: 'डैशबोर्ड',
                website: 'वेबसाइट एडिटर',
                payments: 'पेमेंट मेथड्स',
                deposits: 'डिपॉजिट्स',
                withdrawals: 'विथड्रॉअल्स',
                users: 'यूजर्स',
                nft: 'NFT मैनेजमेंट',
                settings: 'सेटिंग्स'
            };
            document.getElementById('pageTitle').textContent = titles[section];
            
            // Show editor toggle only for website section
            document.getElementById('editorToggle').classList.toggle('hidden', section !== 'website');
            
            // Load section data
            if (section === 'payments') loadPaymentMethods();
            if (section === 'deposits') loadDeposits();
            if (section === 'withdrawals') loadWithdrawals();
            if (section === 'users') loadUsers();
            if (section === 'nft') loadNFTs();
            if (section === 'website') loadContentEditor();
        }
        
        // ==========================================
        // DASHBOARD
        // ==========================================
        
        function initDashboard() {
            loadStats();
            initChart();
            loadPaymentStatus();
            
            // Real-time listeners
            db.collection('users').onSnapshot(snapshot => {
                document.getElementById('totalUsers').textContent = snapshot.size;
            });
            
            db.collection('deposits').where('status', '==', 'pending').onSnapshot(snapshot => {
                const count = snapshot.size;
                document.getElementById('pendingDeposits').textContent = count;
                const badge = document.getElementById('depositBadge');
                badge.textContent = count;
                badge.classList.toggle('hidden', count === 0);
            });
            
            db.collection('withdrawals').where('status', '==', 'pending').onSnapshot(snapshot => {
                const count = snapshot.size;
                document.getElementById('pendingWithdrawals').textContent = count;
                const badge = document.getElementById('withdrawalBadge');
                badge.textContent = count;
                badge.classList.toggle('hidden', count === 0);
            });
        }
        
        function loadStats() {
            // Calculate total deposits
            db.collection('deposits').where('status', '==', 'approved').get().then(snapshot => {
                let total = 0;
                snapshot.forEach(doc => total += doc.data().amount);
                document.getElementById('totalDeposits').textContent = '₹' + total.toLocaleString();
            });
        }
        
        function initChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['सोम', 'मंगल', 'बुध', 'गुरु', 'शुक्र', 'शनि', 'रवि'],
                    datasets: [{
                        label: 'डिपॉजिट्स',
                        data: [65, 59, 80, 81, 56, 55, 40],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'विथड्रॉअल्स',
                        data: [28, 48, 40, 19, 86, 27, 90],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: { 
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        function loadPaymentStatus() {
            const container = document.getElementById('paymentStatusList');
            db.collection('paymentMethods').get().then(snapshot => {
                let html = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    html += `
                        <div class="flex justify-between items-center p-3 bg-[#0f172a] rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full ${data.status === 'active' ? 'bg-[#10b981]/20 text-[#10b981]' : 'bg-[#ef4444]/20 text-[#ef4444]'} flex items-center justify-center">
                                    <i class="fas ${data.type === 'upi' ? 'fa-qrcode' : data.type === 'bank' ? 'fa-university' : 'fa-coins'}"></i>
                                </div>
                                <div>
                                    <div class="font-medium">${data.name || data.upiId || data.bankName}</div>
                                    <div class="text-xs text-[#94a3b8] capitalize">${data.type}</div>
                                </div>
                            </div>
                            <div class="toggle-switch ${data.status === 'active' ? 'active' : ''}" onclick="togglePaymentStatus('${doc.id}', this)"></div>
                        </div>
                    `;
                });
                container.innerHTML = html || '<p class="text-[#94a3b8] text-center">कोई पेमेंट मेथड नहीं</p>';
            });
        }
        
        // ==========================================
        // PAYMENT METHODS MANAGEMENT
        // ==========================================
        
        function switchPaymentTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab + 'Payments').classList.add('active');
        }
        
        function openPaymentModal() {
            document.getElementById('paymentModal').classList.add('active');
            document.getElementById('paymentModalTitle').textContent = 'पेमेंट मेथड जोड़ें';
            resetPaymentForm();
        }
        
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }
        
        function resetPaymentForm() {
            document.getElementById('paymentId').value = '';
            document.getElementById('upiId').value = '';
            document.getElementById('upiName').value = '';
            document.getElementById('bankName').value = '';
            document.getElementById('accountNumber').value = '';
            document.getElementById('ifscCode').value = '';
            document.getElementById('accountHolder').value = '';
            document.getElementById('cryptoAddress').value = '';
            document.getElementById('minDeposit').value = '100';
            document.getElementById('maxDeposit').value = '100000';
            document.getElementById('paymentActive').checked = true;
            document.getElementById('qrPreview').classList.add('hidden');
            updatePaymentForm();
        }
        
        function updatePaymentForm() {
            const type = document.getElementById('paymentType').value;
            document.getElementById('upiFields').classList.toggle('hidden', type !== 'upi');
            document.getElementById('bankFields').classList.toggle('hidden', type !== 'bank');
            document.getElementById('cryptoFields').classList.toggle('hidden', type !== 'crypto');
        }
        
        function previewQR(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('qrPreview').src = e.target.result;
                    document.getElementById('qrPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', cloudinaryUploadPreset);
            
            const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudinaryCloudName}/image/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            return data.secure_url;
        }
        
        async function savePaymentMethod() {
            const id = document.getElementById('paymentId').value;
            const type = document.getElementById('paymentType').value;
            
            const data = {
                type,
                status: document.getElementById('paymentActive').checked ? 'active' : 'inactive',
                minDeposit: parseInt(document.getElementById('minDeposit').value),
                maxDeposit: parseInt(document.getElementById('maxDeposit').value),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (type === 'upi') {
                data.upiId = document.getElementById('upiId').value;
                data.name = document.getElementById('upiName').value;
                
                const qrFile = document.getElementById('upiQr').files[0];
                if (qrFile) {
                    data.qrCode = await uploadToCloudinary(qrFile);
                }
            } else if (type === 'bank') {
                data.bankName = document.getElementById('bankName').value;
                data.accountNumber = document.getElementById('accountNumber').value;
                data.ifsc = document.getElementById('ifscCode').value;
                data.accountHolder = document.getElementById('accountHolder').value;
                data.name = data.bankName + ' - ' + data.accountNumber;
            } else if (type === 'crypto') {
                data.currency = document.getElementById('cryptoCurrency').value;
                data.network = document.getElementById('cryptoNetwork').value;
                data.address = document.getElementById('cryptoAddress').value;
                data.name = data.currency + ' (' + data.network + ')';
            }
            
            try {
                if (id) {
                    await db.collection('paymentMethods').doc(id).update(data);
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('paymentMethods').add(data);
                }
                
                showToast('पेमेंट मेथड सेव हो गया!', 'success');
                closePaymentModal();
                loadPaymentMethods();
                loadPaymentStatus();
            } catch (error) {
                showToast('त्रुटि: ' + error.message, 'error');
            }
        }
        
        function loadPaymentMethods() {
            db.collection('paymentMethods').get().then(snapshot => {
                const upiList = document.getElementById('upiList');
                const bankList = document.getElementById('bankList');
                const cryptoList = document.getElementById('cryptoList');
                
                upiList.innerHTML = '';
                bankList.innerHTML = '';
                cryptoList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const card = createPaymentCard(doc.id, data);
                    
                    if (data.type === 'upi') upiList.appendChild(card);
                    else if (data.type === 'bank') bankList.appendChild(card);
                    else if (data.type === 'crypto') cryptoList.appendChild(card);
                });
            });
        }
        
        function createPaymentCard(id, data) {
            const div = document.createElement('div');
            div.className = `payment-card ${data.status}`;
            div.innerHTML = `
                <span class="status-badge ${data.status}">${data.status === 'active' ? 'सक्रिय' : 'निष्क्रिय'}</span>
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 rounded-full bg-[#3b82f6]/20 flex items-center justify-center text-[#3b82f6]">
                        <i class="fas ${data.type === 'upi' ? 'fa-qrcode' : data.type === 'bank' ? 'fa-university' : 'fa-coins'} text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-bold">${data.name}</h4>
                        <p class="text-sm text-[#94a3b8] capitalize">${data.type}</p>
                    </div>
                </div>
                
                <div class="space-y-2 text-sm mb-4">
                    ${data.upiId ? `<div class="flex justify-between"><span class="text-[#94a3b8]">UPI ID:</span> <span class="font-mono">${data.upiId}</span></div>` : ''}
                    ${data.accountNumber ? `<div class="flex justify-between"><span class="text-[#94a3b8]">Account:</span> <span class="font-mono">${data.accountNumber}</span></div>` : ''}
                    ${data.address ? `<div class="flex justify-between"><span class="text-[#94a3b8]">Address:</span> <span class="font-mono text-xs">${data.address.substr(0, 20)}...</span></div>` : ''}
                    <div class="flex justify-between"><span class="text-[#94a3b8]">Limit:</span> <span>₹${data.minDeposit} - ₹${data.maxDeposit}</span></div>
                </div>
                
                ${data.qrCode ? `<img src="${data.qrCode}" class="w-full h-40 object-contain bg-white rounded-lg mb-4">` : ''}
                
                <div class="flex gap-2">
                    <button onclick="editPayment('${id}')" class="flex-1 btn btn-primary text-sm justify-center">
                        <i class="fas fa-edit"></i> एडिट
                    </button>
                    <button onclick="deletePayment('${id}')" class="flex-1 btn btn-danger text-sm justify-center">
                        <i class="fas fa-trash"></i> डिलीट
                    </button>
                </div>
            `;
            return div;
        }
        
        async function editPayment(id) {
            const doc = await db.collection('paymentMethods').doc(id).get();
            const data = doc.data();
            
            document.getElementById('paymentId').value = id;
            document.getElementById('paymentType').value = data.type;
            document.getElementById('minDeposit').value = data.minDeposit;
            document.getElementById('maxDeposit').value = data.maxDeposit;
            document.getElementById('paymentActive').checked = data.status === 'active';
            
            if (data.type === 'upi') {
                document.getElementById('upiId').value = data.upiId || '';
                document.getElementById('upiName').value = data.name || '';
                if (data.qrCode) {
                    document.getElementById('qrPreview').src = data.qrCode;
                    document.getElementById('qrPreview').classList.remove('hidden');
                }
            } else if (data.type === 'bank') {
                document.getElementById('bankName').value = data.bankName || '';
                document.getElementById('accountNumber').value = data.accountNumber || '';
                document.getElementById('ifscCode').value = data.ifsc || '';
                document.getElementById('accountHolder').value = data.accountHolder || '';
            } else if (data.type === 'crypto') {
                document.getElementById('cryptoCurrency').value = data.currency || 'USDT';
                document.getElementById('cryptoNetwork').value = data.network || 'TRC20';
                document.getElementById('cryptoAddress').value = data.address || '';
            }
            
            updatePaymentForm();
            document.getElementById('paymentModal').classList.add('active');
            document.getElementById('paymentModalTitle').textContent = 'पेमेंट मेथड एडिट करें';
        }
        
        async function deletePayment(id) {
            if (!confirm('क्या आप सुनिश्चित हैं?')) return;
            await db.collection('paymentMethods').doc(id).delete();
            showToast('डिलीट हो गया!', 'success');
            loadPaymentMethods();
            loadPaymentStatus();
        }
        
        async function togglePaymentStatus(id, el) {
            const isActive = el.classList.contains('active');
            await db.collection('paymentMethods').doc(id).update({
                status: isActive ? 'inactive' : 'active'
            });
            el.classList.toggle('active');
            showToast(isActive ? 'निष्क्रिय कर दिया गया' : 'सक्रिय कर दिया गया', 'success');
            loadPaymentMethods();
        }
        
        // ==========================================
        // DEPOSITS & WITHDRAWALS
        // ==========================================
        
        function loadDeposits() {
            const tbody = document.getElementById('depositsTable');
            tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">लोड हो रहा है...</td></tr>';
            
            db.collection('deposits').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${data.userId?.substr(0, 8) || 'N/A'}...</td>
                        <td><span class="px-2 py-1 rounded bg-[#3b82f6]/20 text-[#3b82f6] text-xs">${data.methodType}</span></td>
                        <td class="font-bold">₹${data.amount}</td>
                        <td class="text-sm">${data.utr || '-'}</td>
                        <td>${data.proofUrl ? `<a href="${data.proofUrl}" target="_blank" class="text-[#3b82f6] hover:underline">देखें</a>` : 'N/A'}</td>
                        <td class="text-sm">${data.createdAt?.toDate().toLocaleDateString()}</td>
                        <td><span class="px-2 py-1 rounded text-xs ${data.status === 'approved' ? 'bg-[#10b981] text-white' : data.status === 'rejected' ? 'bg-[#ef4444] text-white' : 'bg-[#f59e0b] text-white'}">${data.status}</span></td>
                        <td>
                            ${data.status === 'pending' ? `
                                <button onclick="approveDeposit('${doc.id}', '${data.userId}', ${data.amount})" class="text-[#10b981] hover:text-[#059669] mr-2" title="स्वीकार करें"><i class="fas fa-check-circle text-xl"></i></button>
                                <button onclick="rejectDeposit('${doc.id}')" class="text-[#ef4444] hover:text-[#dc2626]" title="अस्वीकार करें"><i class="fas fa-times-circle text-xl"></i></button>
                            ` : '-'}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }
        
        async function approveDeposit(id, userId, amount) {
            try {
                await db.collection('deposits').doc(id).update({ status: 'approved', approvedAt: new Date() });
                await db.collection('wallets').doc(userId).update({
                    spotBalance: firebase.firestore.FieldValue.increment(amount)
                });
                showToast('डिपॉजिट स्वीकृत और बैलेंस जोड़ा गया!', 'success');
            } catch (e) {
                showToast('त्रुटि: ' + e.message, 'error');
            }
        }
        
        async function rejectDeposit(id) {
            const reason = prompt('अस्वीकृति का कारण:');
            if (reason) {
                await db.collection('deposits').doc(id).update({ status: 'rejected', reason });
                showToast('डिपॉजिट अस्वीकृत', 'info');
            }
        }
        
        function loadWithdrawals() {
            const tbody = document.getElementById('withdrawalsTable');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">लोड हो रहा है...</td></tr>';
            
            db.collection('withdrawals').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${data.userId?.substr(0, 8) || 'N/A'}...</td>
                        <td><span class="px-2 py-1 rounded bg-[#3b82f6]/20 text-[#3b82f6] text-xs">${data.method}</span></td>
                        <td class="font-bold">₹${data.amount}</td>
                        <td class="text-sm">${data.details?.upiId || data.details?.accountNumber || data.details?.address?.substr(0, 15) + '...'}</td>
                        <td class="text-sm">${data.createdAt?.toDate().toLocaleDateString()}</td>
                        <td><span class="px-2 py-1 rounded text-xs ${data.status === 'completed' ? 'bg-[#10b981] text-white' : data.status === 'rejected' ? 'bg-[#ef4444] text-white' : 'bg-[#f59e0b] text-white'}">${data.status}</span></td>
                        <td>
                            ${data.status === 'pending' ? `
                                <button onclick="completeWithdrawal('${doc.id}')" class="text-[#10b981] hover:text-[#059669] mr-2" title="पूरा करें"><i class="fas fa-check-circle text-xl"></i></button>
                                <button onclick="rejectWithdrawal('${doc.id}', '${data.userId}', ${data.amount})" class="text-[#ef4444] hover:text-[#dc2626]" title="अस्वीकार करें"><i class="fas fa-times-circle text-xl"></i></button>
                            ` : '-'}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }
        
        async function completeWithdrawal(id) {
            await db.collection('withdrawals').doc(id).update({ status: 'completed', completedAt: new Date() });
            showToast('विथड्रॉअल पूरा हुआ!', 'success');
        }
        
        async function rejectWithdrawal(id, userId, amount) {
            const reason = prompt('अस्वीकृति का कारण:');
            if (reason) {
                await db.collection('withdrawals').doc(id).update({ status: 'rejected', reason });
                await db.collection('wallets').doc(userId).update({
                    spotBalance: firebase.firestore.FieldValue.increment(amount)
                });
                showToast('विथड्रॉअल अस्वीकृत और राशि वापस की गई', 'info');
            }
        }
        
        // ==========================================
        // USERS MANAGEMENT
        // ==========================================
        
        function loadUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">लोड हो रहा है...</td></tr>';
            
            db.collection('users').get().then(snapshot => {
                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    
                    // Get wallet data
                    db.collection('wallets').doc(doc.id).get().then(walletDoc => {
                        const wallet = walletDoc.exists ? walletDoc.data() : { spotBalance: 0 };
                        
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="font-mono text-xs">${doc.id.substr(0, 12)}...</td>
                            <td>
                                <div class="flex items-center gap-2">
                                    <img src="${data.avatar || 'https://placehold.co/40'}" class="w-8 h-8 rounded-full">
                                    <span>${data.name || 'N/A'}</span>
                                </div>
                            </td>
                            <td>${data.email}</td>
                            <td class="font-bold">₹${wallet.spotBalance || 0}</td>
                            <td><span class="px-2 py-1 rounded text-xs ${data.kycStatus === 'verified' ? 'bg-[#10b981] text-white' : 'bg-[#f59e0b] text-white'}">${data.kycStatus || 'pending'}</span></td>
                            <td><span class="px-2 py-1 rounded text-xs ${data.isActive !== false ? 'bg-[#10b981] text-white' : 'bg-[#ef4444] text-white'}">${data.isActive !== false ? 'सक्रिय' : 'निष्क्रिय'}</span></td>
                            <td>
                                <button onclick="editUser('${doc.id}')" class="text-[#3b82f6] hover:text-[#2563eb] mr-2"><i class="fas fa-edit"></i></button>
                                <button onclick="toggleUser('${doc.id}', ${data.isActive !== false})" class="text-[#f59e0b] hover:text-[#d97706]"><i class="fas fa-power-off"></i></button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
            });
        }
        
        function editUser(id) {
            const balance = prompt('नया बैलेंस दर्ज करें:');
            if (balance !== null) {
                db.collection('wallets').doc(id).update({ spotBalance: parseFloat(balance) });
                showToast('बैलेंस अपडेट हो गया!', 'success');
                loadUsers();
            }
        }
        
        async function toggleUser(id, currentStatus) {
            await db.collection('users').doc(id).update({ isActive: !currentStatus });
            showToast(currentStatus ? 'यूजर निष्क्रिय कर दिया गया' : 'यूजर सक्रिय कर दिया गया', 'success');
            loadUsers();
        }
        
        // ==========================================
        // NFT MANAGEMENT
        // ==========================================
        
        function loadNFTs() {
            const grid = document.getElementById('nftGrid');
            grid.innerHTML = '<div class="col-span-4 text-center py-8">लोड हो रहा है...</div>';
            
            db.collection('nfts').onSnapshot(snapshot => {
                grid.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'bg-[#1e293b] border border-[#334155] rounded-xl overflow-hidden';
                    div.innerHTML = `
                        <img src="${data.imageUrl}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h4 class="font-bold mb-1">${data.name}</h4>
                            <p class="text-[#94a3b8] text-sm mb-3">${data.price} ETH</p>
                            <div class="flex gap-2">
                                <button onclick="editNFT('${doc.id}')" class="flex-1 btn btn-primary text-sm justify-center"><i class="fas fa-edit"></i></button>
                                <button onclick="deleteNFT('${doc.id}')" class="flex-1 btn btn-danger text-sm justify-center"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `;
                    grid.appendChild(div);
                });
            });
        }
        
        function openNFTModal() {
            document.getElementById('nftModal').classList.add('active');
            document.getElementById('nftId').value = '';
            document.getElementById('nftName').value = '';
            document.getElementById('nftDesc').value = '';
            document.getElementById('nftPrice').value = '';
            document.getElementById('nftPreview').classList.add('hidden');
        }
        
        function closeNFTModal() {
            document.getElementById('nftModal').classList.remove('active');
        }
        
        function previewNFT(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('nftPreview').src = e.target.result;
                    document.getElementById('nftPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        async function saveNFT() {
            const id = document.getElementById('nftId').value;
            const name = document.getElementById('nftName').value;
            const desc = document.getElementById('nftDesc').value;
            const price = document.getElementById('nftPrice').value;
            const category = document.getElementById('nftCategory').value;
            const file = document.getElementById('nftImage').files[0];
            
            if (!name || !price) {
                showToast('कृपया नाम और कीमत दर्ज करें', 'error');
                return;
            }
            
            try {
                let imageUrl = 'https://placehold.co/400';
                if (file) {
                    imageUrl = await uploadToCloudinary(file);
                } else if (id) {
                    const doc = await db.collection('nfts').doc(id).get();
                    imageUrl = doc.data().imageUrl;
                }
                
                const data = {
                    name, description: desc, price: parseFloat(price), category, imageUrl,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (id) {
                    await db.collection('nfts').doc(id).update(data);
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    data.status = 'active';
                    await db.collection('nfts').add(data);
                }
                
                showToast('NFT सेव हो गया!', 'success');
                closeNFTModal();
            } catch (e) {
                showToast('त्रुटि: ' + e.message, 'error');
            }
        }
        
        async function editNFT(id) {
            const doc = await db.collection('nfts').doc(id).get();
            const data = doc.data();
            
            document.getElementById('nftId').value = id;
            document.getElementById('nftName').value = data.name;
            document.getElementById('nftDesc').value = data.description || '';
            document.getElementById('nftPrice').value = data.price;
            document.getElementById('nftCategory').value = data.category || 'art';
            
            if (data.imageUrl) {
                document.getElementById('nftPreview').src = data.imageUrl;
                document.getElementById('nftPreview').classList.remove('hidden');
            }
            
            document.getElementById('nftModal').classList.add('active');
        }
        
        async function deleteNFT(id) {
            if (!confirm('क्या आप सुनिश्चित हैं?')) return;
            await db.collection('nfts').doc(id).update({ status: 'deleted' });
            showToast('NFT डिलीट हो गया!', 'success');
        }
        
        // ==========================================
        // WEBSITE CONTENT EDITOR
        // ==========================================
        
        function loadContentEditor() {
            const grid = document.getElementById('contentEditorGrid');
            const keys = [
                'site_title', 'logo_text', 'hero_title', 'hero_subtitle', 
                'nav_spot', 'nav_futures', 'nav_nft', 'nav_wallet',
                'btn_login', 'btn_register', 'btn_deposit', 'wallet_title'
            ];
            
            grid.innerHTML = '';
            keys.forEach(key => {
                const div = document.createElement('div');
                div.className = 'bg-[#0f172a] border border-[#334155] rounded-lg p-4 cursor-pointer hover:border-[#3b82f6] transition';
                div.onclick = () => openEditModal(key);
                
                div.innerHTML = `
                    <div class="text-xs text-[#94a3b8] mb-1 uppercase tracking-wider">${key}</div>
                    <div class="font-medium truncate" id="content-${key}">लोड हो रहा है...</div>
                `;
                grid.appendChild(div);
            });
            
            // Load actual values
            db.collection('siteContent').get().then(snapshot => {
                snapshot.forEach(doc => {
                    const el = document.getElementById(`content-${doc.id}`);
                    if (el) el.textContent = doc.data().value;
                });
            });
        }
        
        function openEditModal(key) {
            currentEditingKey = key;
            document.getElementById('editKey').value = key;
            
            db.collection('siteContent').doc(key).get().then(doc => {
                document.getElementById('editValue').value = doc.exists ? doc.data().value : '';
                document.getElementById('editContentModal').classList.add('active');
            });
        }
        
        function closeEditModal() {
            document.getElementById('editContentModal').classList.remove('active');
            currentEditingKey = null;
        }
        
        async function saveContentEdit() {
            const value = document.getElementById('editValue').value;
            
            await db.collection('siteContent').doc(currentEditingKey).set({
                value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            showToast('कंटेंट अपडेट हो गया!', 'success');
            loadContentEditor();
            closeEditModal();
        }
        
        function toggleEditorMode() {
            editorMode = !editorMode;
            document.body.classList.toggle('editor-mode', editorMode);
            
            const btn = document.getElementById('editorToggle');
            if (editorMode) {
                btn.innerHTML = '<i class="fas fa-eye"></i> प्रीव्यू मोड';
                btn.classList.remove('btn-warning');
                btn.classList.add('btn-success');
                showToast('एडिटर मोड चालू! किसी भी आइटम पर क्लिक करें', 'success');
                
                // Add click listeners to editable elements
                document.querySelectorAll('#contentEditorGrid > div').forEach(el => {
                    el.style.pointerEvents = 'auto';
                });
            } else {
                btn.innerHTML = '<i class="fas fa-pencil-alt"></i> एडिटर मोड';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-success');
            }
        }
        
        function refreshContent() {
            loadContentEditor();
            showToast('रीफ्रेश हो गया!', 'success');
        }
        
        // ==========================================
        // SETTINGS
        // ==========================================
        
        function toggleSetting(el, setting) {
            el.classList.toggle('active');
            const isActive = el.classList.contains('active');
            showToast(`${setting} ${isActive ? 'चालू' : 'बंद'} हो गया`, 'success');
            // Save to settings collection
            db.collection('settings').doc('system').set({ [setting]: isActive }, { merge: true });
        }
        
        function changeAdminPassword() {
            const newPass = prompt('नया पासवर्ड दर्ज करें:');
            if (newPass) {
                showToast('पासवर्ड बदल दिया गया! (डेमो मोड)', 'success');
            }
        }
        
        function backupDatabase() {
            showToast('डेटाबेस बैकअप डाउनलोड हो रहा है...', 'info');
            // Implementation for backup
        }
        
        function clearCache() {
            showToast('कैश साफ़ हो गया!', 'success');
        }
        
        // ==========================================
        // UTILITIES
        // ==========================================
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast border-l-4 ${type === 'success' ? 'border-l-[#10b981]' : type === 'error' ? 'border-l-[#ef4444]' : 'border-l-[#3b82f6]'}`;
            toast.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas ${type === 'success' ? 'fa-check-circle text-[#10b981]' : type === 'error' ? 'fa-exclamation-circle text-[#ef4444]' : 'fa-info-circle text-[#3b82f6]'}"></i>
                    <span>${message}</span>
                </div>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }
        
        // Enter key for login
        document.getElementById('adminPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') adminLogin();
        });
    </script>
</body>
  </html>
